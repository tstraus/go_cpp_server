<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
</head>
<body>

<svg id="board" width="75%" height="75%" viewBox="0 0 1900 1900" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.41421;">
    <g transform="matrix(0.642939,-2.34414e-18,-2.34414e-18,0.65251,-7.77196,-22.2387)">
        <path d="M2967.26,92.318C2967.26,60.177 2940.78,34.082 2908.16,34.082L71.192,34.082C38.572,34.082 12.088,60.177 12.088,92.318L12.088,2887.68C12.088,2919.82 38.572,2945.91 71.192,2945.91L2908.16,2945.91C2940.78,2945.91 2967.26,2919.82 2967.26,2887.68L2967.26,92.318Z" style="fill:rgb(248,220,154);"/>
    </g>
    <g transform="matrix(0.735021,-2.27644e-18,-2.27644e-18,0.744315,-130.914,-161.059)">
        <rect x="246.135" y="283.562" width="2448.91" height="2418.33" style="fill:none;stroke-width:13.52px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(1,8.81986e-17,8.81986e-17,0.639902,-459.164,-6.12509)">
        <path d="M1409.16,87.709L1409.16,2900.64" style="fill:none;stroke-width:11.91px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(1,8.81986e-17,8.81986e-17,0.639902,-1259.16,-6.12509)">
        <path d="M1409.16,87.709L1409.16,2900.64" style="fill:none;stroke-width:11.91px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(1,8.81986e-17,8.81986e-17,0.639902,-1159.16,-6.12509)">
        <path d="M1409.16,87.709L1409.16,2900.64" style="fill:none;stroke-width:11.91px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(1,8.81986e-17,8.81986e-17,0.639902,-1059.16,-6.12509)">
        <path d="M1409.16,87.709L1409.16,2900.64" style="fill:none;stroke-width:11.91px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(1,8.81986e-17,8.81986e-17,0.639902,-859.164,-6.12509)">
        <path d="M1409.16,87.709L1409.16,2900.64" style="fill:none;stroke-width:11.91px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(1,8.81986e-17,8.81986e-17,0.639902,-959.164,-6.12509)">
        <path d="M1409.16,87.709L1409.16,2900.64" style="fill:none;stroke-width:11.91px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(1,8.81986e-17,8.81986e-17,0.639902,-759.164,-6.12509)">
        <path d="M1409.16,87.709L1409.16,2900.64" style="fill:none;stroke-width:11.91px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(1,8.81986e-17,8.81986e-17,0.639902,-659.164,-6.12509)">
        <path d="M1409.16,87.709L1409.16,2900.64" style="fill:none;stroke-width:11.91px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(1,8.81986e-17,8.81986e-17,0.639902,-559.164,-6.12509)">
        <path d="M1409.16,87.709L1409.16,2900.64" style="fill:none;stroke-width:11.91px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(1,8.81986e-17,8.81986e-17,0.639902,-159.164,-6.12509)">
        <path d="M1409.16,87.709L1409.16,2900.64" style="fill:none;stroke-width:11.91px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(1,8.81986e-17,8.81986e-17,0.639902,-359.164,-6.12509)">
        <path d="M1409.16,87.709L1409.16,2900.64" style="fill:none;stroke-width:11.91px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(1,8.81986e-17,8.81986e-17,0.639902,-259.164,-6.12509)">
        <path d="M1409.16,87.709L1409.16,2900.64" style="fill:none;stroke-width:11.91px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(1,8.81986e-17,8.81986e-17,0.639902,140.836,-6.12509)">
        <path d="M1409.16,87.709L1409.16,2900.64" style="fill:none;stroke-width:11.91px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(1,8.81986e-17,8.81986e-17,0.639902,-59.1643,-6.12509)">
        <path d="M1409.16,87.709L1409.16,2900.64" style="fill:none;stroke-width:11.91px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(1,8.81986e-17,8.81986e-17,0.639902,40.8357,-6.12509)">
        <path d="M1409.16,87.709L1409.16,2900.64" style="fill:none;stroke-width:11.91px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(1,8.81986e-17,8.81986e-17,0.639902,240.836,-6.12509)">
        <path d="M1409.16,87.709L1409.16,2900.64" style="fill:none;stroke-width:11.91px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(1,8.81986e-17,8.81986e-17,0.639902,340.836,-6.12509)">
        <path d="M1409.16,87.709L1409.16,2900.64" style="fill:none;stroke-width:11.91px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.996507,-8.55641e-19,-8.55641e-19,1,1.54424,-39.267)">
        <path d="M48.626,989.267L1854.94,989.267" style="fill:none;stroke-width:10.02px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.996507,-8.55641e-19,-8.55641e-19,1,1.54424,60.733)">
        <path d="M48.626,989.267L1854.94,989.267" style="fill:none;stroke-width:10.02px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.996507,-8.55641e-19,-8.55641e-19,1,1.54424,160.733)">
        <path d="M48.626,989.267L1854.94,989.267" style="fill:none;stroke-width:10.02px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.996507,-8.55641e-19,-8.55641e-19,1,1.54424,260.733)">
        <path d="M48.626,989.267L1854.94,989.267" style="fill:none;stroke-width:10.02px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.996507,-8.55641e-19,-8.55641e-19,1,1.54424,360.733)">
        <path d="M48.626,989.267L1854.94,989.267" style="fill:none;stroke-width:10.02px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.996507,-8.55641e-19,-8.55641e-19,1,1.54424,460.733)">
        <path d="M48.626,989.267L1854.94,989.267" style="fill:none;stroke-width:10.02px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.996507,-8.55641e-19,-8.55641e-19,1,1.54424,560.733)">
        <path d="M48.626,989.267L1854.94,989.267" style="fill:none;stroke-width:10.02px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.996507,-8.55641e-19,-8.55641e-19,1,1.54424,660.733)">
        <path d="M48.626,989.267L1854.94,989.267" style="fill:none;stroke-width:10.02px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.996507,-8.55641e-19,-8.55641e-19,1,1.54424,760.733)">
        <path d="M48.626,989.267L1854.94,989.267" style="fill:none;stroke-width:10.02px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.996507,-8.55641e-19,-8.55641e-19,1,1.54424,-139.267)">
        <path d="M48.626,989.267L1854.94,989.267" style="fill:none;stroke-width:10.02px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.996507,-8.55641e-19,-8.55641e-19,1,1.54424,-239.267)">
        <path d="M48.626,989.267L1854.94,989.267" style="fill:none;stroke-width:10.02px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.996507,-8.55641e-19,-8.55641e-19,1,1.54424,-339.267)">
        <path d="M48.626,989.267L1854.94,989.267" style="fill:none;stroke-width:10.02px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.996507,-8.55641e-19,-8.55641e-19,1,1.54424,-439.267)">
        <path d="M48.626,989.267L1854.94,989.267" style="fill:none;stroke-width:10.02px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.996507,-8.55641e-19,-8.55641e-19,1,1.54424,-539.267)">
        <path d="M48.626,989.267L1854.94,989.267" style="fill:none;stroke-width:10.02px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.996507,-8.55641e-19,-8.55641e-19,1,1.54424,-639.267)">
        <path d="M48.626,989.267L1854.94,989.267" style="fill:none;stroke-width:10.02px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.996507,-8.55641e-19,-8.55641e-19,1,1.54424,-739.267)">
        <path d="M48.626,989.267L1854.94,989.267" style="fill:none;stroke-width:10.02px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.996507,-8.55641e-19,-8.55641e-19,1,1.54424,-839.267)">
        <path d="M48.626,989.267L1854.94,989.267" style="fill:none;stroke-width:10.02px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.691238,-4.04415e-17,-7.5625e-17,0.534764,294.425,161.284)">
        <rect x="926.708" y="324.847" width="43.4" height="56.099" style="fill:rgb(144,90,13);stroke-width:16.18px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.691238,-4.04415e-17,-7.5625e-17,0.534764,894.425,161.284)">
        <rect x="926.708" y="324.847" width="43.4" height="56.099" style="fill:rgb(144,90,13);stroke-width:16.18px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.691238,-4.04415e-17,-7.5625e-17,0.534764,-305.575,161.284)">
        <rect x="926.708" y="324.847" width="43.4" height="56.099" style="fill:rgb(144,90,13);stroke-width:16.18px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.691238,-4.04415e-17,-7.5625e-17,0.534764,294.425,761.284)">
        <rect x="926.708" y="324.847" width="43.4" height="56.099" style="fill:rgb(144,90,13);stroke-width:16.18px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.691238,-4.04415e-17,-7.5625e-17,0.534764,894.425,761.284)">
        <rect x="926.708" y="324.847" width="43.4" height="56.099" style="fill:rgb(144,90,13);stroke-width:16.18px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.691238,-4.04415e-17,-7.5625e-17,0.534764,-305.575,761.284)">
        <rect x="926.708" y="324.847" width="43.4" height="56.099" style="fill:rgb(144,90,13);stroke-width:16.18px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.691238,-4.04415e-17,-7.5625e-17,0.534764,294.425,1361.28)">
        <rect x="926.708" y="324.847" width="43.4" height="56.099" style="fill:rgb(144,90,13);stroke-width:16.18px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.691238,-4.04415e-17,-7.5625e-17,0.534764,894.425,1361.28)">
        <rect x="926.708" y="324.847" width="43.4" height="56.099" style="fill:rgb(144,90,13);stroke-width:16.18px;stroke:rgb(143,90,15);"/>
    </g>
    <g transform="matrix(0.691238,-4.04415e-17,-7.5625e-17,0.534764,-305.575,1361.28)">
        <rect x="926.708" y="324.847" width="43.4" height="56.099" style="fill:rgb(144,90,13);stroke-width:16.18px;stroke:rgb(143,90,15);"/>
    </g>
</svg>
<br>

<input id="msg" type="text" title="chat"/>
<button id="send">Send</button>
<br>
<textarea id="log" cols=100 rows=10></textarea>

<script>
    var sock = new WebSocket("ws://{{host}}/go")

    var gameID = "";

    function createArray(length) {
        var arr = new Array(length || 0), i = length

        if (arguments.length > 1) {
            var args = Array.prototype.slice.call(arguments, 1)
            while (i--) arr[length - 1 - i] = createArray.apply(this, args)
        }

        return arr
    }

    var display = document.getElementById('board')
    var board = createArray(19, 19)
    var pt = display.createSVGPoint()
    var black = true

    function newGame() {
        board = createArray(19, 19)
        pt = display.createSVGPoint()
        black = true
    }

    function cursourPoint(evt) {
        pt.x = evt.clientX
        pt.y = evt.clientY
        return pt.matrixTransform(display.getScreenCTM().inverse())
    }

    function placeStone(location, color) {
        x = Math.round((location.x - 50) / 100)
        y = Math.round((location.y - 50) / 100)

        if (!(board[y][x] === 'b') && !(board[y][x] === 'white')) {
            sock.send(JSON.stringify({
                gameID: gameID,
                action: 'attemptMove',
                data: {
                    black: black,
                    x: x,
                    y: y
                }
            }));
        }
    }

    function drawStone(x, y, color) {
        var circle = document.createElementNS("http://www.w3.org/2000/svg", 'circle')
        circle.setAttribute('cx', x * 100 + 50)
        circle.setAttribute('cy', y * 100 + 50)
        circle.setAttribute('r', '40')

        if (color === 'b') {
            circle.setAttribute('fill', 'black')
        }

        if (color === 'w') {
            circle.setAttribute('fill', 'white')
        }

        display.appendChild(circle)
    }

    function refreshBoard(data) {
        for (var y = 0; y < 19; y++) {
            for (var x = 0; x < 19; x++) {
                if (data[y][x] === 'b' || data[y][x] === 'w') {
                    drawStone(x, y, data[y][x])
                    board[y][x] = data[y][x]
                }
            }
        }
    }

    display.addEventListener('click', function (evt) {
        var loc = cursourPoint(evt);

        if (black) {
            placeStone(loc, 'black')
        }

        else {
            placeStone(loc, 'white')
        }
    }, false)

    window.onload = function()
    {
        newGame()
    }

    sock.onopen = () => {
        console.log('open')
    }

    sock.onerror = (event) => {
        console.log('error', event)
    }

    sock.onclose = () => {
        console.log('close')
    }

    sock.onmessage = (event) => {
        msg = JSON.parse(event.data)
        console.log(msg)

        switch (msg.action) {
            case 'newGame':
                gameID = msg.gameID
                black = msg.data.black
                break

            case 'joinGame':
                gameID = msg.gameID
                black = msg.data.black
                break

            case 'move':
                if (msg.gameID === gameID) {
                    if (msg.data.black) {
                        board[msg.data.y][msg.data.x] = 'b'
                    }

                    else {
                        board[msg.data.y][msg.data.x] = 'w'
                    }

                    drawStone(msg.data.x, msg.data.y, board[msg.data.y][msg.data.x])
                }

                break

            case 'chat':
                if (msg.gameID === gameID) {
                    $("#log").val(
                        msg.data.msg + "\n" + $("#log").val()
                    )
                }
                break
        }
    }

    function sendChat() {
        sock.send(JSON.stringify({
            gameID: gameID,
            action: 'chat',
            data: {
                msg: $("#msg").val()
            }
        }))

        $("#msg").val("")
    }

    $("#msg").keypress(function(e) {
        if (e.which == 13) {
             sendChat()
        }
    })

    $("#send").click(() => {
        sendChat()
    })
</script>
</body>
</html>
